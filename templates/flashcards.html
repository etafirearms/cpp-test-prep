{% extends "base.html" %}

{% block title %}Flashcards - {{ flashcard_data.topic }} - CPP Test Prep{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header text-center">
                <h4><i class="fas fa-layer-group me-2"></i>{{ flashcard_data.topic|title }}</h4>
                <p class="mb-0">Card <span id="current-card">1</span> of {{ flashcard_data.cards|length }}</p>
            </div>
            <div class="card-body text-center" style="min-height: 300px;">
                <div id="flashcard-container">
                    <div class="flashcard" onclick="flipCard()">
                        <div class="flashcard-content p-4">
                            <div id="card-front">
                                <h5>{{ flashcard_data.cards[0].front }}</h5>
                                <p class="text-muted mt-4">Click to reveal answer</p>
                            </div>
                            <div id="card-back" style="display: none;">
                                <h5>{{ flashcard_data.cards[0].back }}</h5>
                                <p class="text-muted mt-4">Click to see question</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4">
                    <button class="btn btn-outline-secondary me-2" onclick="previousCard()">
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button class="btn btn-outline-secondary" onclick="nextCard()">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                
                <div class="mt-3">
                    <button class="btn btn-success me-2" onclick="markKnown()">
                        <i class="fas fa-check"></i> Know It
                    </button>
                    <button class="btn btn-warning" onclick="markUnsure()">
                        <i class="fas fa-question"></i> Review Later
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Suggested CPP Topics -->
<div class="row mt-4 justify-content-center">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-body text-center">
                <h6>Study Different Topics</h6>
                <div class="btn-group-vertical w-100">
                    <a href="{{ url_for('flashcards', topic='risk assessment') }}" class="btn btn-outline-primary">Risk Assessment</a>
                    <a href="{{ url_for('flashcards', topic='CPTED (Crime Prevention Through Environmental Design)') }}" class="btn btn-outline-primary">CPTED</a>
                    <a href="{{ url_for('flashcards', topic='access control and authentication') }}" class="btn btn-outline-primary">Access Control</a>
                    <a href="{{ url_for('flashcards', topic='investigations: interview & evidence basics') }}" class="btn btn-outline-primary">Investigations</a>
                    <a href="{{ url_for('flashcards', topic='incident response and crisis communication') }}" class="btn btn-outline-primary">Incident Response</a>
                    <a href="{{ url_for('flashcards', topic='information security fundamentals') }}" class="btn btn-outline-primary">Information Security</a>
                    <a href="{{ url_for('flashcards', topic='personnel security & insider threat') }}" class="btn btn-outline-primary">Personnel Security</a>
                    <a href="{{ url_for('flashcards', topic='business principles: budgeting and contracts') }}" class="btn btn-outline-primary">Business Principles</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const cards = {{ flashcard_data.cards|tojson }};
let currentIndex = 0;
let isFlipped = false;

function flipCard() {
    const front = document.getElementById('card-front');
    const back = document.getElementById('card-back');
    if (isFlipped) {
        front.style.display = 'block';
        back.style.display = 'none';
        isFlipped = false;
    } else {
        front.style.display = 'none';
        back.style.display = 'block';
        isFlipped = true;
    }
}

function nextCard() {
    if (currentIndex < cards.length - 1) {
        currentIndex++;
        updateCard();
    }
}

function previousCard() {
    if (currentIndex > 0) {
        currentIndex--;
        updateCard();
    }
}

function updateCard() {
    document.getElementById('card-front').innerHTML = `
        <h5>${escapeHtml(cards[currentIndex].front)}</h5>
        <p class="text-muted mt-4">Click to reveal answer</p>
    `;
    document.getElementById('card-back').innerHTML = `
        <h5>${escapeHtml(cards[currentIndex].back)}</h5>
        <p class="text-muted mt-4">Click to see question</p>
    `;

    // Reset to front
    document.getElementById('card-front').style.display = 'block';
    document.getElementById('card-back').style.display = 'none';
    isFlipped = false;

    // Update counter
    document.getElementById('current-card').textContent = currentIndex + 1;
}

function markKnown() {
    const card = document.querySelector('.flashcard');
    card.style.background = 'linear-gradient(45deg, #28a745, #20c997)';
    setTimeout(() => {
        card.style.background = '';
        nextCard();
    }, 400);
}

function markUnsure() {
    const card = document.querySelector('.flashcard');
    card.style.background = 'linear-gradient(45deg, #ffc107, #fd7e14)';
    setTimeout(() => {
        card.style.background = '';
        nextCard();
    }, 400);
}

// simple HTML escape for safety
function escapeHtml(str) {
  if (str == null) return '';
  return String(str)
    .replaceAll('&', '&amp;')
    .replaceAll('<', '&lt;')
    .replaceAll('>', '&gt;')
    .replaceAll('"', '&quot;')
    .replaceAll("'", '&#039;');
}
</script>
{% endblock %}
