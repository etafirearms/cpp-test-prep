// Replace the entire <script> section in quiz_selector.html with this:
<script>
  // --- State ---
  let selectedQuizKey = 'practice';
  let selectedQuizName = 'Practice Quiz';
  let selectedDomainKey = '';
  let selectedDomainName = 'General';
  let selectedDifficulty = 'medium';

  // Helper function to update display
  function updateSelectionDisplay() {
    const selQuiz = document.getElementById('selQuiz');
    const selDomain = document.getElementById('selDomain');
    const selDiff = document.getElementById('selDiff');
    
    if (selQuiz) selQuiz.textContent = selectedQuizName;
    if (selDomain) selDomain.textContent = selectedDomainName;
    if (selDiff) selDiff.textContent = selectedDifficulty.charAt(0).toUpperCase() + selectedDifficulty.slice(1);
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    console.log('Quiz selector initializing...');

    // --- Quiz type buttons ---
    const quizButtons = document.querySelectorAll('#quizTypeList button');
    console.log('Found quiz buttons:', quizButtons.length);
    
    quizButtons.forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('Quiz button clicked:', btn.getAttribute('data-quiz-key'));
        
        // Remove active class from all
        quizButtons.forEach(b => b.classList.remove('active'));
        // Add active to clicked
        btn.classList.add('active');

        selectedQuizKey = btn.getAttribute('data-quiz-key') || 'practice';
        const nameElement = btn.querySelector('.fw-bold');
        selectedQuizName = nameElement ? nameElement.textContent.trim() : 'Practice Quiz';
        
        updateSelectionDisplay();
      });
    });

    // Set default active quiz button
    const defaultQuizBtn = document.querySelector('#quizTypeList button[data-quiz-key="practice"]') || 
                          document.querySelector('#quizTypeList button');
    if (defaultQuizBtn) {
      defaultQuizBtn.classList.add('active');
      selectedQuizKey = defaultQuizBtn.getAttribute('data-quiz-key') || 'practice';
      const nameElement = defaultQuizBtn.querySelector('.fw-bold');
      selectedQuizName = nameElement ? nameElement.textContent.trim() : 'Practice Quiz';
    }

    // --- Domain buttons ---
    const domainButtons = document.querySelectorAll('#domainList button');
    console.log('Found domain buttons:', domainButtons.length);
    
    domainButtons.forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('Domain button clicked:', btn.getAttribute('data-domain'));
        
        // Remove active class from all
        domainButtons.forEach(b => b.classList.remove('active'));
        // Add active to clicked
        btn.classList.add('active');

        selectedDomainKey = btn.getAttribute('data-domain') || '';
        const nameElement = btn.querySelector('.fw-bold');
        selectedDomainName = nameElement ? nameElement.textContent.trim() : 'General';
        
        updateSelectionDisplay();
      });
    });

    // --- Difficulty radios ---
    const difficultyInputs = document.querySelectorAll('#difficultyGroup input[name="difficulty"]');
    console.log('Found difficulty inputs:', difficultyInputs.length);
    
    difficultyInputs.forEach(input => {
      input.addEventListener('change', function() {
        selectedDifficulty = input.value;
        console.log('Difficulty changed to:', selectedDifficulty);
        updateSelectionDisplay();
      });
    });

    // Set initial difficulty display
    const checkedDiff = document.querySelector('#difficultyGroup input[name="difficulty"]:checked');
    if (checkedDiff) {
      selectedDifficulty = checkedDiff.value;
    }

    // --- Start button ---
    const startBtn = document.getElementById('startBtn');
    if (startBtn) {
      startBtn.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('Start button clicked');
        console.log('Selected quiz:', selectedQuizKey);
        console.log('Selected domain:', selectedDomainKey);
        console.log('Selected difficulty:', selectedDifficulty);

        // Disable button to prevent double-clicks
        startBtn.disabled = true;
        startBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Loading...';

        // Build URL with parameters
        const params = new URLSearchParams();
        if (selectedDomainKey) {
          params.set('domain', selectedDomainKey);
        }
        if (selectedDifficulty) {
          params.set('difficulty', selectedDifficulty);
        }

        const quizUrl = `/quiz/${encodeURIComponent(selectedQuizKey)}${params.toString() ? '?' + params.toString() : ''}`;
        console.log('Navigating to:', quizUrl);

        // Navigate to quiz
        window.location.href = quizUrl;
      });
    } else {
      console.error('Start button not found');
    }

    // Initial display update
    updateSelectionDisplay();
    
    console.log('Quiz selector initialization complete');
  });
</script>
